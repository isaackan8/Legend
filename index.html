<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>台灣樹木探索家</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/marked@4.0.0/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        
        :root {
            --primary-color: #5D5CDE;
            --accent-color: #4CAF50;
            --light-bg: #FFFFFF;
            --dark-bg: #181818;
            --light-text: #333333;
            --dark-text: #F0F0F0;
        }
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
        }
        
        .dark {
            color-scheme: dark;
        }
        
        .tree-card {
            transition: transform 0.3s ease;
        }
        
        .tree-card:hover {
            transform: translateY(-5px);
        }
        
        .badge {
            transition: all 0.3s ease;
        }
        
        .badge-locked {
            filter: grayscale(1);
            opacity: 0.5;
        }
        
        .map-marker {
            transform-origin: bottom center;
            transition: transform 0.3s ease;
        }
        
        .map-marker:hover {
            transform: scale(1.2);
        }
        
        .camera-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .scanner-line {
            animation: scan 2s infinite linear;
        }
        
        @keyframes scan {
            0% { transform: translateY(0); opacity: 0.5; }
            50% { transform: translateY(100px); opacity: 1; }
            100% { transform: translateY(200px); opacity: 0.5; }
        }
        
        .dark .tree-info {
            background-color: #2A2A2A;
            color: var(--dark-text);
        }
        
        .light .tree-info {
            background-color: #F5F5F5;
            color: var(--light-text);
        }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        accent: '#4CAF50',
                        success: '#28a745',
                        warning: '#ffc107',
                        danger: '#dc3545'
                    }
                }
            }
        }
    </script>
</head>
<body class="transition-colors duration-300 bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200">
    <!-- 檢測暗模式 -->
    <script>
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>

    <div class="min-h-screen">
        <!-- 頂部導航 -->
        <nav class="bg-white dark:bg-gray-800 shadow-md">
            <div class="container mx-auto px-4 py-3">
                <div class="flex justify-between items-center">
                    <div class="flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-accent mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 9.5l7-7 7 7M5 19.5l7-7 7 7" />
                        </svg>
                        <h1 class="text-xl font-bold">台灣樹木探索家</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="bg-green-100 dark:bg-green-900 px-3 py-1 rounded-full flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-accent mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span id="point-display" class="font-medium text-green-800 dark:text-green-200">0</span>
                        </div>
                        <div class="bg-blue-100 dark:bg-blue-900 px-3 py-1 rounded-full flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
                            </svg>
                            <span id="discovery-count" class="font-medium text-blue-800 dark:text-blue-200">0 / 12</span>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- 主要內容 -->
        <div class="container mx-auto px-4 py-6">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- 左側面板 - QR碼掃描模擬 -->
                <div class="lg:col-span-1">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-6">
                        <h2 class="text-lg font-bold mb-4">樹木QR碼掃描</h2>
                        <div id="qr-scanner" class="relative bg-gray-200 dark:bg-gray-700 rounded-lg h-64 flex items-center justify-center mb-4 overflow-hidden">
                            <div class="absolute inset-0 flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-gray-500 dark:text-gray-400 camera-animation" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                                </svg>
                            </div>
                            <div class="absolute left-0 right-0 h-px bg-green-500 opacity-75 scanner-line"></div>
                            <div class="absolute inset-0 border-2 border-dashed border-gray-500 dark:border-gray-400 rounded-lg pointer-events-none"></div>
                        </div>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">請選擇模擬QR碼進行掃描：</p>
                        <div class="grid grid-cols-2 gap-2 mb-4">
                            <button class="simulate-scan bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 py-2 px-3 rounded text-sm" data-tree-id="1">台大校園榕樹</button>
                            <button class="simulate-scan bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 py-2 px-3 rounded text-sm" data-tree-id="2">日月潭楓香</button>
                            <button class="simulate-scan bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 py-2 px-3 rounded text-sm" data-tree-id="3">阿里山紅檜</button>
                            <button class="simulate-scan bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 py-2 px-3 rounded text-sm" data-tree-id="4">淡水老榕樹</button>
                            <button class="simulate-scan bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 py-2 px-3 rounded text-sm" data-tree-id="5">太魯閣九芎</button>
                            <button class="simulate-scan bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 py-2 px-3 rounded text-sm" data-tree-id="6">墾丁龍柏</button>
                            <button class="simulate-scan bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 py-2 px-3 rounded text-sm" data-tree-id="7">陽明山牡丹</button>
                            <button class="simulate-scan bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 py-2 px-3 rounded text-sm" data-tree-id="8">高雄老樟樹</button>
                            <button class="simulate-scan bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 py-2 px-3 rounded text-sm" data-tree-id="9">鹿港老芒果樹</button>
                            <button class="simulate-scan bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 py-2 px-3 rounded text-sm" data-tree-id="10">宜蘭羅東樟樹</button>
                            <button class="simulate-scan bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 py-2 px-3 rounded text-sm" data-tree-id="11">花蓮琉球松</button>
                            <button class="simulate-scan bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 py-2 px-3 rounded text-sm" data-tree-id="12">台東蘇鐵</button>
                        </div>
                    </div>

                    <!-- 徽章收集區 -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4">
                        <h2 class="text-lg font-bold mb-4">徽章收集</h2>
                        <div class="grid grid-cols-3 gap-3" id="badge-collection">
                            <!-- 徽章將由JavaScript動態生成 -->
                        </div>
                    </div>
                </div>

                <!-- 中間面板 - 樹木資訊 -->
                <div class="lg:col-span-1">
                    <div id="tree-info-panel" class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-6 min-h-[500px]">
                        <div class="flex items-center justify-center h-full">
                            <div class="text-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-20 w-20 text-gray-400 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                <h3 class="text-lg font-medium text-gray-600 dark:text-gray-400">請掃描QR碼</h3>
                                <p class="text-gray-500 dark:text-gray-500 mt-2">選擇左側的樹木QR碼來獲取資訊</p>
                            </div>
                        </div>
                    </div>

                    <!-- 知識挑戰 -->
                    <div id="quiz-panel" class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 hidden">
                        <h2 class="text-lg font-bold mb-4">樹木知識挑戰</h2>
                        <div id="quiz-container">
                            <p id="quiz-question" class="mb-4"></p>
                            <div id="quiz-options" class="space-y-2 mb-4"></div>
                            <div id="quiz-feedback" class="p-3 rounded-lg mb-4 hidden"></div>
                            <button id="quiz-button" class="bg-primary hover:bg-blue-700 text-white py-2 px-4 rounded">確認答案</button>
                        </div>
                    </div>
                </div>

                <!-- 右側面板 - 台灣地圖 -->
                <div class="lg:col-span-1">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 min-h-[600px]">
                        <h2 class="text-lg font-bold mb-4">探索地圖</h2>
                        <div class="relative">
                            <svg id="taiwan-map" viewBox="0 0 400 600" class="w-full h-auto">
                                <!-- 台灣地圖輪廓 -->
                                <path d="M200,100 Q300,150 320,250 Q340,350 320,450 Q300,500 250,550 Q200,580 150,550 Q100,500 80,450 Q60,350 80,250 Q100,150 200,100" fill="#e5e7eb" stroke="#9ca3af" stroke-width="2" class="dark:fill-gray-700 dark:stroke-gray-600" />
                                
                                <!-- 主要城市標記 -->
                                <circle cx="180" cy="150" r="5" fill="#4b5563" class="dark:fill-gray-400" />
                                <text x="190" y="155" font-size="12" fill="currentColor">台北</text>
                                
                                <circle cx="200" cy="200" r="5" fill="#4b5563" class="dark:fill-gray-400" />
                                <text x="210" y="205" font-size="12" fill="currentColor">桃園</text>
                                
                                <circle cx="170" cy="250" r="5" fill="#4b5563" class="dark:fill-gray-400" />
                                <text x="180" y="255" font-size="12" fill="currentColor">台中</text>
                                
                                <circle cx="150" cy="350" r="5" fill="#4b5563" class="dark:fill-gray-400" />
                                <text x="160" y="355" font-size="12" fill="currentColor">台南</text>
                                
                                <circle cx="140" cy="400" r="5" fill="#4b5563" class="dark:fill-gray-400" />
                                <text x="150" y="405" font-size="12" fill="currentColor">高雄</text>
                                
                                <circle cx="260" cy="350" r="5" fill="#4b5563" class="dark:fill-gray-400" />
                                <text x="270" y="355" font-size="12" fill="currentColor">花蓮</text>
                                
                                <circle cx="240" cy="450" r="5" fill="#4b5563" class="dark:fill-gray-400" />
                                <text x="250" y="455" font-size="12" fill="currentColor">台東</text>
                                
                                <circle cx="120" cy="180" r="5" fill="#4b5563" class="dark:fill-gray-400" />
                                <text x="130" y="185" font-size="12" fill="currentColor">新竹</text>
                                
                                <circle cx="290" cy="200" r="5" fill="#4b5563" class="dark:fill-gray-400" />
                                <text x="300" y="205" font-size="12" fill="currentColor">宜蘭</text>
                                
                                <!-- 樹木標記將由JavaScript動態生成 -->
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 樹木數據庫
        const trees = [
            {
                id: 1,
                name: "台大校園榕樹",
                scientificName: "Ficus microcarpa",
                location: "台北市大安區",
                coordinates: { x: 180, y: 140 },
                age: "約150年",
                height: "25公尺",
                description: "這棵百年老榕樹位於台灣大學校園內，是校園中最具代表性的樹木之一。它的氣根垂下形成多個支柱，創造出獨特的景觀，也為校園提供了良好的遮蔭。",
                ecologicalValue: "提供多種鳥類和昆蟲棲息地，是都市中的生態熱點。",
                culturalValue: "是台大學生聚會、討論的熱門地點，也是校園文化的重要象徵。",
                badge: "榕樹守護者",
                badgeColor: "bg-emerald-500",
                imageData: generateTreeImage("榕樹", "#2F4F4F", "#90EE90", 20)
            },
            {
                id: 2,
                name: "日月潭楓香",
                scientificName: "Liquidambar formosana",
                location: "南投縣魚池鄉",
                coordinates: { x: 160, y: 280 },
                age: "約80年",
                height: "18公尺",
                description: "日月潭畔的楓香樹群是台灣中部著名的賞楓勝地。每到秋季，楓香葉片轉為紅色和橙色，吸引大量遊客前來觀賞。",
                ecologicalValue: "楓香的果實是多種野生動物的食物來源，葉片分解後也豐富了土壤養分。",
                culturalValue: "是台灣重要的觀光資源，也象徵著台灣的四季變化之美。",
                badge: "賞楓達人",
                badgeColor: "bg-red-500",
                imageData: generateTreeImage("楓香", "#8B0000", "#FF6347", 15)
            },
            {
                id: 3,
                name: "阿里山紅檜",
                scientificName: "Chamaecyparis formosensis",
                location: "嘉義縣阿里山",
                coordinates: { x: 160, y: 320 },
                age: "約2000年",
                height: "43公尺",
                description: "阿里山紅檜是台灣特有種，也是世界上最珍貴的針葉樹之一。這些巨木見證了台灣數千年的自然歷史，有些樹齡超過2000年。",
                ecologicalValue: "是台灣高山生態系統的關鍵物種，提供了獨特的棲息環境。",
                culturalValue: "被視為台灣自然遺產的重要象徵，也與原住民文化有深厚連結。",
                badge: "森林守護者",
                badgeColor: "bg-green-800",
                imageData: generateTreeImage("紅檜", "#006400", "#228B22", 25)
            },
            {
                id: 4,
                name: "淡水老榕樹",
                scientificName: "Ficus religiosa",
                location: "新北市淡水區",
                coordinates: { x: 175, y: 130 },
                age: "約300年",
                height: "20公尺",
                description: "位於淡水老街附近的這棵百年榕樹，見證了淡水從清朝、日治到現代的歷史變遷。其巨大的樹冠成為淡水地標之一。",
                ecologicalValue: "老樹的樹洞為多種鳥類提供了棲息地，也是城市生物多樣性的重要元素。",
                culturalValue: "與淡水的歷史發展緊密相連，是當地文化記憶的一部分。",
                badge: "歷史探索者",
                badgeColor: "bg-amber-600",
                imageData: generateTreeImage("老榕樹", "#4B3621", "#8B4513", 22)
            },
            {
                id: 5,
                name: "太魯閣九芎",
                scientificName: "Lagerstroemia subcostata",
                location: "花蓮縣秀林鄉",
                coordinates: { x: 260, y: 320 },
                age: "約120年",
                height: "15公尺",
                description: "生長在太魯閣國家公園內的九芎樹群，是台灣原生闊葉樹種。每年夏末秋初，粉紅色的花朵盛開，為峽谷增添色彩。",
                ecologicalValue: "花朵是重要的蜜源，吸引蝴蝶和蜜蜂等授粉者，果實則提供鳥類食物。",
                culturalValue: "與太魯閣族的傳統生活有關，樹皮曾被用於製作工具和藥物。",
                badge: "峽谷植物學家",
                badgeColor: "bg-pink-500",
                imageData: generateTreeImage("九芎", "#4B0082", "#DDA0DD", 18)
            },
            {
                id: 6,
                name: "墾丁龍柏",
                scientificName: "Juniperus chinensis",
                location: "屏東縣恆春鎮",
                coordinates: { x: 140, y: 480 },
                age: "約200年",
                height: "12公尺",
                description: "位於墾丁國家公園的這些龍柏樹，長期受到海風吹拂，形成了獨特的彎曲形態，展現了植物適應環境的能力。",
                ecologicalValue: "在乾燥多風的海岸環境中提供重要的生態服務，包括防風固沙。",
                culturalValue: "在中國傳統文化中，龍柏被視為吉祥樹種，象徵長壽和堅韌。",
                badge: "海岸植物專家",
                badgeColor: "bg-blue-500",
                imageData: generateTreeImage("龍柏", "#00008B", "#1E90FF", 16)
            },
            {
                id: 7,
                name: "陽明山牡丹",
                scientificName: "Rhododendron pseudochrysanthum",
                location: "台北市北投區",
                coordinates: { x: 185, y: 120 },
                age: "約50年",
                height: "3公尺",
                description: "陽明山國家公園的台灣原生杜鵑花（俗稱高山牡丹），是台灣高山植物的代表之一。每年春季花開時節，吸引大量遊客。",
                ecologicalValue: "適應了高山環境，是台灣高海拔生態系統的重要組成部分。",
                culturalValue: "被選為台北市的市花，也是台灣高山景觀的重要象徵之一。",
                badge: "高山花卉專家",
                badgeColor: "bg-purple-500",
                imageData: generateTreeImage("杜鵑", "#800080", "#FF00FF", 10)
            },
            {
                id: 8,
                name: "高雄老樟樹",
                scientificName: "Cinnamomum camphora",
                location: "高雄市鼓山區",
                coordinates: { x: 140, y: 410 },
                age: "約400年",
                height: "30公尺",
                description: "高雄市區內的這棵古樟樹，樹齡約400年，是台灣南部最古老的樹木之一。其龐大的樹冠直徑超過20公尺，提供了城市中珍貴的綠蔭。",
                ecologicalValue: "古樹是城市生物多樣性的重要庇護所，支持多種鳥類、昆蟲和微生物的生存。",
                culturalValue: "見證了高雄從小漁村發展為現代化城市的過程，是城市記憶的載體。",
                badge: "古樹保護者",
                badgeColor: "bg-gray-700",
                imageData: generateTreeImage("樟樹", "#556B2F", "#BDB76B", 28)
            },
            {
                id: 9,
                name: "鹿港老芒果樹",
                scientificName: "Mangifera indica",
                location: "彰化縣鹿港鎮",
                coordinates: { x: 155, y: 230 },
                age: "約250年",
                height: "15公尺",
                description: "鹿港老街附近的這棵古芒果樹，據傳是清朝時期從中國大陸引進的第一批芒果樹之一。雖年事已高，但每年仍結出甜美的芒果。",
                ecologicalValue: "老果樹提供了豐富的食物資源，吸引鳥類和蝙蝠等動物，促進種子傳播。",
                culturalValue: "與台灣農業歷史息息相關，也是展示台灣與外部世界交流的活見證。",
                badge: "果樹研究員",
                badgeColor: "bg-yellow-500",
                imageData: generateTreeImage("芒果樹", "#FFD700", "#FFFACD", 14)
            },
            {
                id: 10,
                name: "宜蘭羅東樟樹",
                scientificName: "Cinnamomum camphora",
                location: "宜蘭縣羅東鎮",
                coordinates: { x: 290, y: 190 },
                age: "約350年",
                height: "25公尺",
                description: "位於羅東林業文化園區的這棵巨大樟樹，是台灣東部重要的自然歷史遺產。在日治時期曾被列為保護樹木，躲過了砍伐的命運。",
                ecologicalValue: "大型樟樹能夠吸收大量二氧化碳，淨化空氣，也為當地提供了重要的生態服務。",
                culturalValue: "與台灣林業發展歷史緊密相連，是理解台灣森林資源利用變遷的重要實體資料。",
                badge: "林業歷史學者",
                badgeColor: "bg-indigo-500",
                imageData: generateTreeImage("樟樹", "#006400", "#7CFC00", 24)
            },
            {
                id: 11,
                name: "花蓮琉球松",
                scientificName: "Pinus luchuensis",
                location: "花蓮縣花蓮市",
                coordinates: { x: 280, y: 280 },
                age: "約100年",
                height: "22公尺",
                description: "花蓮市區內的這片琉球松林，是日治時期引進種植的。這些松樹形成了城市中獨特的景觀，也成為當地居民休閒的好去處。",
                ecologicalValue: "松樹可以在惡劣的環境中生長，有助於水土保持和防風固沙。",
                culturalValue: "反映了日本殖民時期的景觀規劃思想，也成為城市綠化的重要案例。",
                badge: "外來種研究者",
                badgeColor: "bg-lime-600",
                imageData: generateTreeImage("琉球松", "#2E8B57", "#66CDAA", 20)
            },
            {
                id: 12,
                name: "台東蘇鐵",
                scientificName: "Cycas revoluta",
                location: "台東縣台東市",
                coordinates: { x: 250, y: 420 },
                age: "約90年",
                height: "5公尺",
                description: "台東知本溫泉區附近的這群蘇鐵，是台灣原生的珍稀植物。蘇鐵是活化石植物，其祖先在恐龍時代就已存在。",
                ecologicalValue: "作為古老的種子植物，蘇鐵在植物演化研究中具有重要價值，也是保育的重點對象。",
                culturalValue: "在原住民文化中有重要地位，種子曾被用於製作食物，也是傳統醫藥的來源。",
                badge: "活化石發現者",
                badgeColor: "bg-orange-500",
                imageData: generateTreeImage("蘇鐵", "#8B4513", "#D2691E", 8)
            }
        ];

        // 問答遊戲數據
        const quizzes = [
            {
                question: "台灣的國樹是什麼?",
                options: ["楓香", "榕樹", "樟樹", "紅檜"],
                answer: 2,
                explanation: "樟樹是台灣的國樹，不僅具有重要的生態價值，也曾經是台灣重要的經濟林木。"
            },
            {
                question: "哪一種樹木是台灣特有種，被稱為「森林之王」?",
                options: ["紅檜", "台灣杉", "牡丹", "九芎"],
                answer: 0,
                explanation: "紅檜是台灣特有種，也是世界上最珍貴的針葉樹之一，被譽為「森林之王」。"
            },
            {
                question: "阿里山紅檜的最高樹齡可達多少年?",
                options: ["約500年", "約1000年", "約2000年", "約3000年"],
                answer: 2,
                explanation: "阿里山紅檜最高樹齡可達約2000年，是台灣最長壽的樹種之一。"
            },
            {
                question: "下列哪種樹在台灣的傳統建築中最常被用來製作屋樑?",
                options: ["樟樹", "榕樹", "楓香", "琉球松"],
                answer: 0,
                explanation: "樟樹木材堅固耐用，且有天然防蟲效果，是台灣傳統建築中重要的建材。"
            },
            {
                question: "下列哪種樹是台北市的市樹?",
                options: ["櫻花", "樟樹", "榕樹", "台灣欒樹"],
                answer: 2,
                explanation: "榕樹是台北市的市樹，象徵堅忍與生生不息的精神。"
            },
            {
                question: "蘇鐵為什麼被稱為「活化石植物」?",
                options: ["因為它的葉子像石頭一樣堅硬", "因為它生長在石頭縫中", "因為它在地質時代就已經存在", "因為它的種子像石頭一樣"],
                answer: 2,
                explanation: "蘇鐵的祖先在恐龍時代就已存在，其基本形態至今未有太大改變，因此被稱為「活化石植物」。"
            }
        ];

        // 遊戲狀態
        let gameState = {
            points: 0,
            discoveredTrees: [],
            completedQuizzes: [],
            badgesEarned: []
        };

        // DOM 元素
        const pointDisplay = document.getElementById('point-display');
        const discoveryCount = document.getElementById('discovery-count');
        const treeInfoPanel = document.getElementById('tree-info-panel');
        const badgeCollection = document.getElementById('badge-collection');
        const taiwanMap = document.getElementById('taiwan-map');
        const quizPanel = document.getElementById('quiz-panel');
        const quizQuestion = document.getElementById('quiz-question');
        const quizOptions = document.getElementById('quiz-options');
        const quizFeedback = document.getElementById('quiz-feedback');
        const quizButton = document.getElementById('quiz-button');

        // 生成樹木圖像
        function generateTreeImage(treeName, trunkColor, leafColor, branchCount) {
            // 建立樹木的SVG表示法
            const svgWidth = 200;
            const svgHeight = 200;
            
            let svgString = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${svgWidth} ${svgHeight}" width="${svgWidth}" height="${svgHeight}">`;
            
            // 根據樹木種類生成不同形狀
            if (treeName.includes("榕樹")) {
                // 榕樹有獨特的氣根
                svgString += `<rect x="90" y="120" width="20" height="80" fill="${trunkColor}" />`;
                
                // 主樹冠
                svgString += `<ellipse cx="100" cy="70" rx="70" ry="60" fill="${leafColor}" />`;
                
                // 氣根
                for (let i = 0; i < 6; i++) {
                    const x = 60 + i * 12;
                    svgString += `<path d="M${x} 100 Q${x} 140 ${x + (i % 2 == 0 ? 10 : -10)} 180" stroke="${trunkColor}" stroke-width="3" fill="none" />`;
                }
            } else if (treeName.includes("松") || treeName.includes("檜")) {
                // 針葉樹
                svgString += `<rect x="90" y="120" width="20" height="80" fill="${trunkColor}" />`;
                
                // 塔形樹冠
                svgString += `<polygon points="100,10 50,180 150,180" fill="${leafColor}" />`;
                
                // 樹枝細節
                for (let i = 0; i < 5; i++) {
                    const y = 30 + i * 30;
                    const width = 30 + i * 10;
                    svgString += `<polygon points="100,${y} ${100-width},${y+15} ${100+width},${y+15}" fill="${leafColor}" />`;
                }
            } else if (treeName.includes("楓香")) {
                // 楓樹
                svgString += `<rect x="90" y="120" width="20" height="80" fill="${trunkColor}" />`;
                
                // 橢圓形樹冠
                svgString += `<ellipse cx="100" cy="70" rx="60" ry="50" fill="${leafColor}" />`;
                
                // 添加楓葉形狀點綴
                for (let i = 0; i < 8; i++) {
                    const x = 70 + Math.random() * 60;
                    const y = 40 + Math.random() * 60;
                    const size = 5 + Math.random() * 8;
                    svgString += `<path d="M${x},${y} l${size},${size/2} l${size/2},${-size} l${-size/2},${-size} l${-size},${size/2} z" fill="#FF6347" />`;
                }
            } else if (treeName.includes("蘇鐵")) {
                // 蘇鐵
                svgString += `<rect x="90" y="140" width="20" height="60" fill="${trunkColor}" />`;
                
                // 放射狀的葉子
                for (let i = 0; i < 12; i++) {
                    const angle = (i / 12) * Math.PI * 2;
                    const x1 = 100;
                    const y1 = 80;
                    const x2 = x1 + Math.cos(angle) * 80;
                    const y2 = y1 + Math.sin(angle) * 80;
                    svgString += `<path d="M${x1},${y1} L${x2},${y2}" stroke="${leafColor}" stroke-width="5" />`;
                }
            } else {
                // 一般闊葉樹
                svgString += `<rect x="90" y="120" width="20" height="80" fill="${trunkColor}" />`;
                
                // 樹冠
                svgString += `<circle cx="100" cy="70" r="60" fill="${leafColor}" />`;
                
                // 樹枝
                for (let i = 0; i < branchCount; i++) {
                    const angle = (i / branchCount) * Math.PI * 2;
                    const length = 30 + Math.random() * 20;
                    const x1 = 100;
                    const y1 = 120;
                    const x2 = x1 + Math.cos(angle) * length;
                    const y2 = y1 + Math.sin(angle) * length;
                    svgString += `<line x1="${x1}" y1="${y1}" x2="${x2}" y2="${y2}" stroke="${trunkColor}" stroke-width="5" />`;
                }
            }
            
            svgString += '</svg>';
            return 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svgString);
        }

        // 初始化徽章
        function initBadges() {
            badgeCollection.innerHTML = '';
            
            trees.forEach(tree => {
                const badge = document.createElement('div');
                badge.className = 'badge badge-locked flex flex-col items-center text-center p-2 rounded-lg';
                badge.setAttribute('data-tree-id', tree.id);
                
                // 檢查是否已獲得徽章
                if (gameState.badgesEarned.includes(tree.id)) {
                    badge.classList.remove('badge-locked');
                    badge.classList.add(tree.badgeColor, 'text-white');
                } else {
                    badge.classList.add('bg-gray-300', 'dark:bg-gray-700');
                }
                
                const icon = document.createElement('div');
                icon.className = 'w-12 h-12 rounded-full flex items-center justify-center mb-1';
                icon.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
                    </svg>
                `;
                
                const name = document.createElement('div');
                name.className = 'text-xs font-medium mt-1';
                if (gameState.badgesEarned.includes(tree.id)) {
                    name.textContent = tree.badge;
                } else {
                    name.textContent = '???';
                }
                
                badge.appendChild(icon);
                badge.appendChild(name);
                badgeCollection.appendChild(badge);
            });
        }

        // 初始化地圖標記
        function initMapMarkers() {
            // 移除現有標記
            const existingMarkers = taiwanMap.querySelectorAll('.tree-marker');
            existingMarkers.forEach(marker => marker.remove());
            
            // 添加新標記
            trees.forEach(tree => {
                if (gameState.discoveredTrees.includes(tree.id)) {
                    const marker = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                    marker.classList.add('tree-marker', 'map-marker');
                    marker.setAttribute('data-tree-id', tree.id);
                    
                    const markerCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    markerCircle.setAttribute('cx', tree.coordinates.x);
                    markerCircle.setAttribute('cy', tree.coordinates.y);
                    markerCircle.setAttribute('r', '8');
                    markerCircle.setAttribute('fill', '#5D5CDE');
                    markerCircle.setAttribute('stroke', '#FFFFFF');
                    markerCircle.setAttribute('stroke-width', '2');
                    
                    marker.appendChild(markerCircle);
                    taiwanMap.appendChild(marker);
                    
                    marker.addEventListener('click', () => showTreeInfo(tree.id));
                }
            });
        }

        // 顯示樹木資訊
        function showTreeInfo(treeId) {
            const tree = trees.find(t => t.id === treeId);
            if (!tree) return;
            
            // 檢查是否是新發現
            let isNewDiscovery = false;
            if (!gameState.discoveredTrees.includes(treeId)) {
                gameState.discoveredTrees.push(treeId);
                gameState.points += 50;
                gameState.badgesEarned.push(treeId);
                updateGameState();
                isNewDiscovery = true;
            }
            
            treeInfoPanel.innerHTML = `
                <div class="flex flex-col">
                    <div class="relative mb-4 rounded-lg overflow-hidden">
                        <img src="${tree.imageData}" alt="${tree.name}" class="w-full h-32 object-cover">
                        <div class="absolute top-0 right-0 p-2">
                            ${isNewDiscovery ? 
                                `<div class="bg-accent text-white px-3 py-1 rounded-full text-xs font-bold animate-pulse">
                                    +50 分！新發現
                                </div>` : ''}
                        </div>
                    </div>
                    
                    <h2 class="text-xl font-bold mb-2">${tree.name}</h2>
                    <p class="text-sm italic text-gray-600 dark:text-gray-400 mb-4">${tree.scientificName}</p>
                    
                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <div class="tree-info light:bg-gray-100 dark:bg-gray-700 p-2 rounded">
                            <div class="text-xs text-gray-500 dark:text-gray-400">位置</div>
                            <div class="font-medium">${tree.location}</div>
                        </div>
                        <div class="tree-info light:bg-gray-100 dark:bg-gray-700 p-2 rounded">
                            <div class="text-xs text-gray-500 dark:text-gray-400">樹齡</div>
                            <div class="font-medium">${tree.age}</div>
                        </div>
                        <div class="tree-info light:bg-gray-100 dark:bg-gray-700 p-2 rounded">
                            <div class="text-xs text-gray-500 dark:text-gray-400">高度</div>
                            <div class="font-medium">${tree.height}</div>
                        </div>
                        <div class="tree-info light:bg-gray-100 dark:bg-gray-700 p-2 rounded">
                            <div class="text-xs text-gray-500 dark:text-gray-400">徽章</div>
                            <div class="font-medium">${tree.badge}</div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h3 class="font-bold mb-1">描述</h3>
                        <p class="text-sm">${tree.description}</p>
                    </div>
                    
                    <div class="mb-4">
                        <h3 class="font-bold mb-1">生態價值</h3>
                        <p class="text-sm">${tree.ecologicalValue}</p>
                    </div>
                    
                    <div class="mb-4">
                        <h3 class="font-bold mb-1">文化意義</h3>
                        <p class="text-sm">${tree.culturalValue}</p>
                    </div>
                    
                    <button id="start-quiz" class="bg-primary hover:bg-blue-700 text-white py-2 px-4 rounded mt-2">
                        參與知識挑戰
                    </button>
                </div>
            `;
            
            document.getElementById('start-quiz').addEventListener('click', () => startQuiz());
        }

        // 開始問答遊戲
        function startQuiz() {
            // 隨機選擇一個未完成的問題
            const availableQuizzes = quizzes.filter(q => !gameState.completedQuizzes.includes(q.question));
            
            if (availableQuizzes.length === 0) {
                // 所有問題都回答過了，重置
                gameState.completedQuizzes = [];
            }
            
            const randomIndex = Math.floor(Math.random() * (availableQuizzes.length || quizzes.length));
            const quiz = availableQuizzes.length ? availableQuizzes[randomIndex] : quizzes[randomIndex];
            
            currentQuiz = quiz;
            quizPanel.classList.remove('hidden');
            quizFeedback.classList.add('hidden');
            
            quizQuestion.textContent = quiz.question;
            quizOptions.innerHTML = '';
            
            quiz.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'quiz-option flex items-center p-2 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer';
                optionElement.innerHTML = `
                    <div class="w-5 h-5 border border-gray-400 dark:border-gray-500 rounded-full flex items-center justify-center mr-2">
                        <div class="option-indicator hidden w-3 h-3 bg-primary rounded-full"></div>
                    </div>
                    <div>${option}</div>
                `;
                optionElement.setAttribute('data-index', index);
                
                optionElement.addEventListener('click', () => {
                    // 移除其它選項的選中狀態
                    document.querySelectorAll('.quiz-option').forEach(opt => {
                        opt.classList.remove('border-primary');
                        opt.querySelector('.option-indicator').classList.add('hidden');
                    });
                    
                    // 添加當前選項的選中狀態
                    optionElement.classList.add('border-primary');
                    optionElement.querySelector('.option-indicator').classList.remove('hidden');
                    
                    selectedOption = index;
                });
                
                quizOptions.appendChild(optionElement);
            });
            
            // 設置提交答案按鈕的事件
            let selectedOption = null;
            quizButton.textContent = '確認答案';
            quizButton.removeEventListener('click', nextQuiz);
            quizButton.addEventListener('click', checkAnswer);
            
            function checkAnswer() {
                if (selectedOption === null) return;
                
                const isCorrect = selectedOption === quiz.answer;
                
                quizFeedback.innerHTML = isCorrect 
                    ? `<div class="text-success font-bold">答對了！獲得30分</div><p>${quiz.explanation}</p>`
                    : `<div class="text-danger font-bold">答錯了！正確答案是：${quiz.options[quiz.answer]}</div><p>${quiz.explanation}</p>`;
                
                quizFeedback.classList.remove('hidden');
                quizFeedback.classList.add(isCorrect ? 'bg-green-100 dark:bg-green-900' : 'bg-red-100 dark:bg-red-900');
                
                if (isCorrect) {
                    gameState.points += 30;
                    updateGameState();
                }
                
                gameState.completedQuizzes.push(quiz.question);
                
                quizButton.textContent = '下一題';
                quizButton.removeEventListener('click', checkAnswer);
                quizButton.addEventListener('click', nextQuiz);
            }
        }

        function nextQuiz() {
            quizPanel.classList.add('hidden');
            startQuiz();
        }

        // 更新遊戲狀態顯示
        function updateGameState() {
            pointDisplay.textContent = gameState.points;
            discoveryCount.textContent = `${gameState.discoveredTrees.length} / ${trees.length}`;
            
            initBadges();
            initMapMarkers();
            
            // 儲存遊戲狀態
            localStorage.setItem('treeGameState', JSON.stringify(gameState));
        }

        // 初始化掃描按鈕事件
        function initScanButtons() {
            document.querySelectorAll('.simulate-scan').forEach(button => {
                button.addEventListener('click', () => {
                    const treeId = parseInt(button.getAttribute('data-tree-id'));
                    simulateScan(treeId);
                });
            });
        }

        // 模擬掃描QR碼
        function simulateScan(treeId) {
            // 掃描動畫
            const scanner = document.getElementById('qr-scanner');
            scanner.classList.add('border-primary');
            
            setTimeout(() => {
                scanner.classList.remove('border-primary');
                showTreeInfo(treeId);
            }, 800);
        }

        // 初始化遊戲
        function initGame() {
            // 嘗試加載已儲存的遊戲狀態
            try {
                const savedState = localStorage.getItem('treeGameState');
                if (savedState) {
                    gameState = JSON.parse(savedState);
                }
            } catch (e) {
                console.error('無法載入已儲存的遊戲狀態:', e);
            }
            
            updateGameState();
            initScanButtons();
            
            // 初始化樹木標記點擊事件
            taiwanMap.addEventListener('click', (e) => {
                const marker = e.target.closest('.tree-marker');
                if (marker) {
                    const treeId = parseInt(marker.getAttribute('data-tree-id'));
                    showTreeInfo(treeId);
                }
            });
        }

        // 啟動遊戲
        initGame();
    </script>
</body>
</html>
